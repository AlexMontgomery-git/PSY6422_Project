---
title: "Overwatch Hero Pick Rates"
author: "Alex Montgomery"
date: "31/04/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) #load tidyverse
library(plotly)    #load plotly for interactive graphing
```

```{r out.width = "50%", fig.align = "center", echo=FALSE}
#Load and Display the Overwatch logo
img1 <- "images/overwatch_logo.png"
knitr::include_graphics(img1)
```

## Overwatch
Overwatch is a team-based multiplayer first-person shooter with a player base of around 10 million players per month. Each match sees a uniquely chosen set of heroes go head to head in a 6v6 battle. Players can choose from 32 heroes belonging to 3 main classes, tank, damage and support. Each team is allowed two heroes from each class. 
The composition of heroes on a team greatly alters 

players have to choose which class to queue in before joining a game meaning once in a game they can only choose from the heroes in the class that they queued in 

## Data Origin
The data set used was scraped from [Overbuff](https://www.overbuff.com/heroes) created March 24th spanning three months back - competitive 

```{r load data, echo=TRUE, warning=FALSE, include=TRUE}
#Load the data set
df = read.csv("hero_stats_3_months.csv")
```

```{r clean data, echo=TRUE, warning=FALSE, include=TRUE}
#Transform original data set to only include the hero and 
df1 <- df %>% select(1, 2, 6, 10, 14, 18, 22, 26)

#Create a variable that is the sum of pick rate across all divisions so that visualisaion 1 can be ordered as desired
df1$totalpick <- rowSums(df1[,c(2:8)])

#Transform df1 to arrange heroes by total pick rate to create the desired order in the visualisation (adding traces in a loop overrides the 'reorder' function in plotly)
dfall <- df1 %>% arrange(desc(totalpick))
```

## Visualisation 1 - Comparing Pick Rate Across Divisions

Need to mention that a grouped bar chart would be better per that article (on brave browser) but too many on the x axis to have a grouped. to combat the issue that stacked bar charts introduced this visualistion was made with plotly to facicilaite hover labels 

A stacked bar chart will show a stand out trend of what hereos are picked more overall across all divisions. A more detailed look at the visualisation will show the differences in pick rate of each hero across the 7 divisions. Using plotly to create the visualisation (instead of ggplot) allows the use of the hover label feature. This feature is especially useful with stacked bar charts as many bars do not have a 0 starting point making it hard to determine the value that the bar represents.

```{r create visualisation, echo=TRUE, warning=FALSE, include=TRUE}


#Set the plot space and add the first division
p1 <- plot_ly(dfall, x = ~hero,
                    y = ~bronze_pick_rate, 
                    name = "Bronze Pick Rate",
                    type = "bar", 
                    width = 900,
                    height = 600,
                    #Set the colour of the first division and create a black line around each bar
                    marker = list(color = "#E0B5AC",
                                  line = list(color = "#000000, 0.5)",
                                  width = 1))) %>%

  #Set the layout specifications of the visualisation
  layout(title = "Hero Pick Rate by Division",
                      #Set the order of the heroes to be determined by the order they appear in the dataset
         xaxis = list(categoryarray = ~hero, 
                      categoryorder = "array",
                      #Set the x axis title and the angle and size of the labels for each hero
                      title = "Hero",
                      tickangle =270),
                      tickfont = list(size = 10),
                      #Set the y axis title, scale format, range and type of bar chart
         yaxis = list(title = "Pick Rate", 
                      tickformat = "%",
                      range = c(0, 0.70)),
                      barmode = "stack")

#Create a value containing the 6 divisions not yet plotted for use in a for loop
  divplot <- colnames(dfall[c(3:8)])
  
#Create a value for use in the add trace loop to set the colours for each division (colours match the exact hex codes that Overbuff assigned to each division)
  colours <- c("#CAD6CC", "#EFEB8B", "#4E98BB", "#D9E8F3", "#EDA152", "#FEE072")
    
#Create a loop to add a trace for each of the remaining divisions
  for(i in divplot){
    p1 <- p1 %>% add_trace(x = dfall[["hero"]], 
                           y = dfall[[i]],
                           #Replace "_" with " " and capitalise the division titles
                           name = gsub(x = i, pattern = "\\_", replacement = " ") %>% str_to_title(i),
                           #Change the colours of the divisions per the "colours" variable previously created
                           marker = list(color = colours[[match(i, divplot)]]))
  }
  
#Display p1 visualisation  
p1
```

Create second visualisation with the heroes split into 4 graphs (offence, defence, tank, support). Rather than using a stacked bar chart use grouped bar charts.

```{r create visualisation, echo=TRUE, warning=FALSE, include=TRUE}
dfoff <- dfall %>% slice(5, 14, 15, 16, 17, 21, 24, 25, 26, 31)

dfdef <- dfall %>% slice(13, 18, 23, 27, 29, 30, 32)

dftnk <- dfall %>% slice(2, 3, 7, 9, 11, 19, 20, 28)

dfsup <- dfall %>% slice(1, 4, 6, 8, 10, 12, 22)

p2 <- p1 %>% slice(5, 14, 15, 16, 17, 21, 24, 25, 26, 31)


p2


```